<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Find Mentor - My Profile
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&amp;display=swap" rel="stylesheet"/>
  <style>
   body {
      font-family: "Inter", sans-serif;
    }
  </style>
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js">
  </script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js">
  </script>
 </head>
 <body class="bg-gray-100 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-white shadow-md sticky top-0 z-30">
   <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex items-center justify-between h-16">
    <div class="flex items-center space-x-3">
     <img alt="Find Mentor logo with letters FM in white on purple background" class="h-10 w-10 rounded" height="40" src="assets/logo.jpg" width="40"/>
     <h1 class="text-2xl font-semibold text-indigo-600">
      Find Mentor
     </h1>
    </div>
    <nav class="hidden md:flex space-x-6 text-gray-700 font-medium">
     <a class="hover:text-indigo-600 transition" href="mentor_dashboard.html">
      Dashboard
     </a>
     <a class="hover:text-indigo-600 transition" href="#">
      My Mentees
     </a>
     <a class="hover:text-indigo-600 transition" href="#">
      Sessions
     </a>
     <a class="hover:text-indigo-600 transition" href="#">
      Messages
     </a>
     <a class="hover:text-indigo-600 transition" href="#">
      Settings
     </a>
    </nav>
    <div class="flex items-center space-x-4">
     <button aria-label="Notifications" class="relative text-gray-600 hover:text-indigo-600 transition focus:outline-none" id="notification-button">
      <i class="fas fa-bell fa-lg">
      </i>
      <span class="absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full px-1.5" id="notification-count">
       0
      </span>
     </button>
     <button aria-expanded="false" aria-haspopup="true" class="flex items-center space-x-2 focus:outline-none" id="user-menu-button">
      <img alt="User avatar" class="h-10 w-10 rounded-full bg-gray-400 flex items-center justify-center text-white font-bold text-lg object-cover" height="40" id="user-avatar" src="https://storage.googleapis.com/a1aa/image/fda119d0-6bf8-476c-2be5-982421f5be7e.jpg" width="40"/>
      <span class="hidden sm:block font-semibold text-gray-700" id="user-name">
       Loading...
      </span>
      <i class="fas fa-chevron-down text-gray-500">
      </i>
     </button>
    </div>
   </div>
  </header>
  <main class="flex-1 max-w-4xl mx-auto p-6 bg-white rounded-lg shadow-md my-8">
   <h2 class="text-3xl font-semibold text-gray-800 mb-8">
    My Profile
   </h2>
   <form class="space-y-8" id="profile-form">
    <!-- Personal Info -->
    <section>
     <h3 class="text-xl font-semibold text-gray-700 mb-4">
      Personal Info
     </h3>
     <div class="flex flex-col md:flex-row md:space-x-8">
      <div class="flex flex-col items-center mb-6 md:mb-0">
       <div aria-label="Profile photo upload" class="relative w-32 h-32 rounded-full bg-gray-200 overflow-hidden cursor-pointer hover:ring-4 hover:ring-indigo-500 transition" id="photo-container" tabindex="0">
        <img alt="Profile photo" class="w-full h-full object-cover" height="128" id="profile-photo" src="https://storage.googleapis.com/a1aa/image/b2f21c29-2384-44ad-997e-d905eb11f09b.jpg" width="128"/>
        <div class="absolute inset-0 bg-black bg-opacity-30 flex items-center justify-center opacity-0 hover:opacity-100 transition">
         <i class="fas fa-camera text-white text-2xl">
         </i>
        </div>
       </div>
       <input accept="image/*" class="hidden" id="photo-input" name="photo" type="file"/>
       <p class="mt-2 text-sm text-gray-500 text-center max-w-xs">
        Click the photo to upload a new profile picture.
       </p>
      </div>
      <div class="flex-1 space-y-4">
       <div>
        <label class="block text-gray-700 font-semibold mb-1" for="name">
         Full Name
        </label>
        <input class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="name" name="name" placeholder="Your full name" required="" type="text"/>
       </div>
       <div>
        <label class="block text-gray-700 font-semibold mb-1" for="bio">
         Bio
        </label>
        <textarea class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="bio" name="bio" placeholder="Write a short bio about yourself" rows="4"></textarea>
       </div>
       <div>
        <label class="block text-gray-700 font-semibold mb-1" for="expertise">
         Expertise
        </label>
        <input class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="expertise" name="expertise" placeholder="E.g. Software Engineering, Career Coaching" type="text"/>
       </div>
      </div>
     </div>
    </section>
    <!-- Experience and Skills -->
    <section>
     <h3 class="text-xl font-semibold text-gray-700 mb-4">
      Experience and Skills
     </h3>
     <textarea class="w-full border border-gray-300 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="experience" name="experience" placeholder="Describe your experience and skills" rows="6"></textarea>
    </section>
    <!-- Availability -->
    <section>
     <h3 class="text-xl font-semibold text-gray-700 mb-4">
      Availability
     </h3>
     <p class="text-gray-600 mb-4">
      Select the days and time ranges you are available for mentoring sessions.
     </p>
     <div class="grid grid-cols-1 sm:grid-cols-2 gap-6 max-w-3xl">
      <!-- Repeat for each day -->
      <div class="flex items-center space-x-4">
       <input class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" id="day-mon" name="availability" type="checkbox" value="Monday"/>
       <label class="font-medium text-gray-700" for="day-mon">
        Monday
       </label>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="mon-start" name="mon-start" type="time"/>
       <span class="text-gray-500">
        to
       </span>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="mon-end" name="mon-end" type="time"/>
      </div>
      <div class="flex items-center space-x-4">
       <input class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" id="day-tue" name="availability" type="checkbox" value="Tuesday"/>
       <label class="font-medium text-gray-700" for="day-tue">
        Tuesday
       </label>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="tue-start" name="tue-start" type="time"/>
       <span class="text-gray-500">
        to
       </span>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="tue-end" name="tue-end" type="time"/>
      </div>
      <div class="flex items-center space-x-4">
       <input class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" id="day-wed" name="availability" type="checkbox" value="Wednesday"/>
       <label class="font-medium text-gray-700" for="day-wed">
        Wednesday
       </label>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="wed-start" name="wed-start" type="time"/>
       <span class="text-gray-500">
        to
       </span>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="wed-end" name="wed-end" type="time"/>
      </div>
      <div class="flex items-center space-x-4">
       <input class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" id="day-thu" name="availability" type="checkbox" value="Thursday"/>
       <label class="font-medium text-gray-700" for="day-thu">
        Thursday
       </label>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="thu-start" name="thu-start" type="time"/>
       <span class="text-gray-500">
        to
       </span>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="thu-end" name="thu-end" type="time"/>
      </div>
      <div class="flex items-center space-x-4">
       <input class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" id="day-fri" name="availability" type="checkbox" value="Friday"/>
       <label class="font-medium text-gray-700" for="day-fri">
        Friday
       </label>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="fri-start" name="fri-start" type="time"/>
       <span class="text-gray-500">
        to
       </span>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="fri-end" name="fri-end" type="time"/>
      </div>
      <div class="flex items-center space-x-4">
       <input class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" id="day-sat" name="availability" type="checkbox" value="Saturday"/>
       <label class="font-medium text-gray-700" for="day-sat">
        Saturday
       </label>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="sat-start" name="sat-start" type="time"/>
       <span class="text-gray-500">
        to
       </span>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="sat-end" name="sat-end" type="time"/>
      </div>
      <div class="flex items-center space-x-4">
       <input class="h-5 w-5 text-indigo-600 border-gray-300 rounded focus:ring-indigo-500" id="day-sun" name="availability" type="checkbox" value="Sunday"/>
       <label class="font-medium text-gray-700" for="day-sun">
        Sunday
       </label>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="sun-start" name="sun-start" type="time"/>
       <span class="text-gray-500">
        to
       </span>
       <input class="border border-gray-300 rounded-md px-3 py-1 focus:outline-none focus:ring-2 focus:ring-indigo-500 w-24" disabled="" id="sun-end" name="sun-end" type="time"/>
      </div>
     </div>
    </section>
    <div class="pt-6 border-t border-gray-200 flex justify-end">
     <button class="bg-indigo-600 text-white px-6 py-3 rounded-md font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500" id="save-btn" type="submit">
      Save Changes
     </button>
    </div>
   </form>
  </main>
  <script>
   // Firebase config - replace with your own config
    const firebaseConfig = {
     apiKey: "AIzaSyAxRNUr78-dnLfFjKdDxvpTOWJrTQUOiZA",
     authDomain: "find-mentor-a6c2e.firebaseapp.com",
     projectId: "find-mentor-a6c2e",
     storageBucket: "find-mentor-a6c2e.firebasestorage.app",
     messagingSenderId: "628413142447",
     appId: "1:628413142447:web:6bd6385b2ee727a8694b5a"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Elements
    const userNameEl = document.getElementById("user-name");
    const userAvatarEl = document.getElementById("user-avatar");
    const profilePhotoEl = document.getElementById("profile-photo");
    const photoInput = document.getElementById("photo-input");
    const photoContainer = document.getElementById("photo-container");
    const form = document.getElementById("profile-form");

    const nameInput = document.getElementById("name");
    const bioInput = document.getElementById("bio");
    const expertiseInput = document.getElementById("expertise");
    const experienceInput = document.getElementById("experience");

    // Availability inputs grouped by day
    const availabilityDays = [
      "mon",
      "tue",
      "wed",
      "thu",
      "fri",
      "sat",
      "sun",
    ];

    // Enable/disable time inputs based on checkbox
    availabilityDays.forEach((day) => {
      const checkbox = document.getElementById(`day-${day}`);
      const startInput = document.getElementById(`${day}-start`);
      const endInput = document.getElementById(`${day}-end`);

      checkbox.addEventListener("change", () => {
        const enabled = checkbox.checked;
        startInput.disabled = !enabled;
        endInput.disabled = !enabled;
        if (!enabled) {
          startInput.value = "";
          endInput.value = "";
        }
      });
    });

    // Handle photo upload click
    photoContainer.addEventListener("click", () => {
      photoInput.click();
    });
    photoContainer.addEventListener("keypress", (e) => {
      if (e.key === "Enter" || e.key === " ") {
        e.preventDefault();
        photoInput.click();
      }
    });

    let uploadedPhotoFile = null;

    photoInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (file) {
        uploadedPhotoFile = file;
        const reader = new FileReader();
        reader.onload = (ev) => {
          profilePhotoEl.src = ev.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    // Load profile data
    function loadProfile(user) {
      userNameEl.textContent = user.displayName || "Mentor";
      if (user.photoURL) {
        userAvatarEl.src = user.photoURL;
        userAvatarEl.alt = `${user.displayName || "Mentor"} avatar`;
      } else {
        const initials = (user.displayName || "M").split(" ").map(n => n[0]).join("").toUpperCase();
        userAvatarEl.src = `https://placehold.co/40x40/png?text=${initials}`;
        userAvatarEl.alt = `${user.displayName || "Mentor"} avatar placeholder`;
      }

      const uid = user.uid;
      const profileRef = db.collection("mentors").doc(uid);

      profileRef.get().then((doc) => {
        if (doc.exists) {
          const data = doc.data();
          nameInput.value = data.name || user.displayName || "";
          bioInput.value = data.bio || "";
          expertiseInput.value = data.expertise || "";
          experienceInput.value = data.experience || "";

          // Load availability
          if (data.availability) {
            availabilityDays.forEach((day) => {
              const dayKey = day.toLowerCase();
              const checkbox = document.getElementById(`day-${day}`);
              const startInput = document.getElementById(`${day}-start`);
              const endInput = document.getElementById(`${day}-end`);
              if (data.availability[dayKey]) {
                checkbox.checked = true;
                startInput.disabled = false;
                endInput.disabled = false;
                startInput.value = data.availability[dayKey].start || "";
                endInput.value = data.availability[dayKey].end || "";
              } else {
                checkbox.checked = false;
                startInput.disabled = true;
                endInput.disabled = true;
                startInput.value = "";
                endInput.value = "";
              }
            });
          }
          // Load profile photo if stored in Firestore (URL)
          if (data.photoURL) {
            profilePhotoEl.src = data.photoURL;
          }
        } else {
          // No profile data, fill with user info
          nameInput.value = user.displayName || "";
          bioInput.value = "";
          expertiseInput.value = "";
          experienceInput.value = "";
        }
      }).catch((error) => {
        console.error("Error loading profile:", error);
      });
    }

    // Save profile data
    async function saveProfile(user) {
      const uid = user.uid;
      const profileRef = db.collection("mentors").doc(uid);

      let photoURL = null;
      if (uploadedPhotoFile) {
        // Upload photo to Firebase Storage
        const storageRef = storage.ref();
        const photoRef = storageRef.child(`mentor_photos/${uid}/${uploadedPhotoFile.name}`);
        try {
          await photoRef.put(uploadedPhotoFile);
          photoURL = await photoRef.getDownloadURL();
        } catch (error) {
          alert("Failed to upload photo: " + error.message);
          return;
        }
      }

      // Prepare availability object
      const availability = {};
      availabilityDays.forEach((day) => {
        const checkbox = document.getElementById(`day-${day}`);
        if (checkbox.checked) {
          const start = document.getElementById(`${day}-start`).value;
          const end = document.getElementById(`${day}-end`).value;
          if (start && end) {
            availability[day] = { start, end };
          }
        }
      });

      // Validate required fields
      if (!nameInput.value.trim()) {
        alert("Name is required.");
        return;
      }

      // Update Firestore document
      try {
        await profileRef.set(
          {
            name: nameInput.value.trim(),
            bio: bioInput.value.trim(),
            expertise: expertiseInput.value.trim(),
            experience: experienceInput.value.trim(),
            availability,
            photoURL: photoURL || undefined,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp(),
          },
          { merge: true }
        );
        alert("Profile saved successfully.");
        if (photoURL) {
          profilePhotoEl.src = photoURL;
          userAvatarEl.src = photoURL;
        }
      } catch (error) {
        alert("Failed to save profile: " + error.message);
      }
    }

    // Auth state listener
    firebase.auth().onAuthStateChanged((user) => {
      if (user) {
        loadProfile(user);
      } else {
        alert("You must be logged in to view this page.");
        // Optionally redirect to login page
      }
    });

    // Form submit handler
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const user = firebase.auth().currentUser;
      if (user) {
        saveProfile(user);
      } else {
        alert("User not authenticated.");
      }
    });
  </script>
 </body>
</html>
